# Разработка модели машинного обучения для прогноза стоимости автомобилей по VIN-коду
**Цель работы:**
Построить и обучить модель машинного обучения (МО), которая позволит предсказать ориентировочную стоимость автомобиля по его VIN-коду.

**Планируемое использование результата работы:**
Заказчику необходим инструмент, который позволит его клиентам уточнить характеристики их автомобилей и оценить ориентировочную стоимость автомобиля.

**Входные данные:**
Заказчик предоставил набор данных о стоимости автомобилей производства Ford с указанием их VIN-кодов.

**Ключевые задачи работы:**
1. Изучить и подготовить данные для разработки модели машинного обучения (МО).
2. Определить условия работки моделей, разработать несколько моделей с использованием различных алгоритмов.
3. Оценить качество работы моделей. Выбрать лучшую модель.
4. Протестировать лучшую модель.
5. Разработать простейший интерфейс взаимодействия клиентов и модели.
6. Сформировать план на дальнейшую работу.

**Критерии заказчика:** Требования заказчика к метрике качества модели не установлены. Требований к скорости обучения и работы моделей не имеется.

**План работы:**

1. Изучение и подготовка данных.
    - Загрузка и изучение данных: изучить входные данные, оценить полноту и качество входных данных для достижения цели исследования; сформировать сводный дата-сет для дальнейшей работы; определить задачи предобработки данных сводного дата-сета;    
    - Преобработка данных: осуществить предобработку данных в части улучшения качества данных для дальнейшего анализа.
    - Исследовательский анализ данных: провести исследовательский анализ данных; оценить необходимость формирования дополнительных категорий, параметров и групп данных для достижения цели исследования, feature engineering: объединить или разделить необходимые данные, сформировать новые признаки, дополнительные категории и группы данных.
    - Корреляционный анализ данных, в том числе предварительный отбор признаков.
    - Подготовка данных: сформировать основные пайп-лайны, разделить дата-сет на выборки.
2. Разработка моделей.
    - Определение условий разработки моделей МО: определиться с критериями разработки моделей, метриками качества моделей, с используемыми алгоритмами, критериями сравнения моделей.
    - Основной этап моделирования: разработать модели, получить результаты для анализа их качества и скорости.
3. Оценка качества работы моделей: выбор лучшей модели.
4. Оценка качества работы лучшей модели на тестовой выборке.
5. Оценка важности признаков.
6. Разработка интефейса взаимодействия клиентов и модели.

**Итоговый вывод**

В ходе работы были выполнены запланированные шаги и достигнуты следующие результаты.

**А. Изучены и проведена предобработка данных**

Основная работа была проведена в части обработки сырых входных данных, представленных в виде текстового файла. С использованием регулярных выражений были получены исходные данные: VIN-коды и стоимость автомобилей. Кроме того, с использованием регулярных выражений все VIN-коды были разделены на значимые блоки, содержащие информацию о характеристиках автомобилей. Произведена преобработка данных: пропусков, дубликатов не обнаружено. Проведена проверка валидности VIN-кодов - проблемных не обнаружено. _Создан дополнительный признак

**Б. Проведены исследовательский и корреляционный анализы данных**

В результате проведения исследовательского анализа было выявлено, что целевой признак "стоимость" автомобиля не содержит выбросов, аномальных значений. Корреляционный анализ показал, что между входными признакими очевидна существенная связь, как блоками одного VIN, а влияние входных признаков на целевой признак оказывают `model`, `engine` и чуть меньше `restarint`, `year` и `plant`.

Исходя из данных в признаках, выявлена целесообразность создание новых признаков, в частности:
    - на основании признака `wmi` можно выделить регион выпуска автомобиля, используя 1-2 символа признка;
    - на основании признака `model` можно выделить тип автомобиля (Passenger Cars, Light Trucks & Multi-Purpose Passenger Vehicles) и его модель;
    - на основании признаков `restraint` и `model` можно выделить restraint types, GVWR class and brake type;
    - на основании признаков `engine` и `model` можно выделить характеристики двигателя автомобиля;
    - на основании признаков `year` и `model` можно выделить год выпуска автомобиля.
Для бейз-лайн модели был создан один признак, отражающий регион выпуска автомобиля.

**В. Подготовлены данные к обучению**

Для дальнейшего обучения моделей МО выполнены следующие работы:
- подготовлены пайплайны с учетом методов обработки данных, принятых на предыдущих этапах работы.
- для потока обучения различных моделей, проведения кросс-валидации создан класс FitPredictGo.
- для сохранения результатов кросс-валидации и последующего анализа моделей создан класс Results.
- подготовлены тренировочная и тестовая выборки в соотношении 80% тренировочной выборки и 20% тестовой выборки.

**Г. Разработаны и обучены модели машинного обучения**

В результате анализа целей и задач работы определены условия разработки моделей МО:
- определено, что в работе необходимо решить задачу регрессии - необходимо спрогнозировать количественный признак, отражающий стоимость автомобилей;
- принято решение контролировать метрику RMSE;
- принято решение также метрику MAPE в целях повышения интерпретируемости модели;.

Был сформирован план основного этапа моделирования - обучить пять моделей без изменения дополнительных гиперпараметров и с подбором гиперпараметров. В результате получить количественные показатели ключевых критериев для дальнейшего анализа.

Перечень построенных моделей:

1. **DummyRegressor()**.
2. **KNeighborsRegressor()**.
4. **DecisionTreeRegressor()**.
5. **CatBoostRegressor()**

Для каждой модели:
1. Построен пайп-лайн предобработки данных. 
2. Обучена модель с учетом кросс-валидации. 
3. Определены сетки подбора гиперпараметров и найдены наилучшие модели с использованием RandomizedSearchCV.
4. Зафиксированы среднее время обучения на тренировочных данных, предсказания на валидационных данных, значения выбранной метрики по результатам кросс-валидации.

Результаты моделирования представлены на графике.

![download](https://github.com/alekFil/carprice_by_vin/assets/131485747/b3fd0eb2-b792-4f0a-9ae8-a7678f411b48)

**Д. Произведен анализ разработанных моделей МО**

В результате анализа времени обучения, времени предсказания и качества моделей сделаны следующие выводы:
1. Модель DecisionTreeRegressor() без подбора гиперпараметров превзошла все другие модели по значению метрики.
2. Самая быстрая модель в обучении модель DecisionTreeRegressor() после подбора гиперпараметров.
3. Самая быстро предсказывающая модель - это снова DecisionTreeRegressor() после подбора гиперпараметров.
4. При этом, стабильность указанных моделей также лучшая.

_В связи с изложенным, лучшей моделью для заказчика признана DecisionTreeRegressor() после подбора гиперпараметров:_
1. Быстро обучается - около 0,1 секунды.
2. Быстро предсказывает - около 0.039 секунд.
3. Качественно предсказывает - RMSE составляет 2805.
    
**Е. Оценка качества модели на тестовой выборке**

В результате проведенной работы лучшая модель для заказчика была протестирована. Результаты работы зафиксированы следующие:
1. Метрика RMSE лучшей модели на тестовой выборке: 2812.631
2. Метрика MAPE лучшей модели на тестовой выборке: 0.202
3. Время предсказания лучшей модели на тестовой выборке: 0.041

Проведена оценка важности признаков. Можно сделать следующие выводы в порядке снижения важности признаков:
- самый важный признак - год выпуска автомобиля. Очевидно, что формирование признака с указанием более точного года выпуска автомобиля увеличить качество модели МО;
- признак завода, на котором был выпущен автомобиль также играет важную роль в формировании стоимости автомобиля. Возможно, объем выпуска автомобилей играет важную роль - чем больше автомобилей выпускалось, тем больше данных для обучения. Кроме того, может репутация заводов играет роль;
- признак модели, характеристик двигателя также немаловажены. Целесообразно расширить данные для обучения подробной расшифровкой указанных признаков.
- World Manufacturer Identifier играет меньшую роль, поскольку представлены автомобили одного производителя. При этом регион выпуска не играет никакой роли.
- Также тип restraint системы играет минимальную роль в оценке стоимости.

Принято решение удалить созданный признак и переобучить модель на оставшихся признаках на полном дата-сете.

**Разработка интефейса взаимодействия клиентов и модели.**

Обученная модель была сохранена и создан класс CarByVin, принимающий строку VIN-кодов, разделенных пробелом, и возвращающий список невалидных VIN-кодов и предсказанную стоимость автомобиля.

**Дальнейшая работа**

С учетом проведенной работы полагается целесообразным осущесвить следующую доработку:
1. Раширить данный для обучения VIN-кодами других производителей.
2. Использовать дополнительные признаки, разрабатываемые на основе зашифрованных характеристик в VIN-кодах.
3. Доработать интрефейс взаимодействия клиентов и модели (раширить класс для полной проверки на валидность и отображения характеристик автомобилей).
4. Реализовать веб-приложение, демонстрирующее работу модели. Например, с использованием streamlit.
